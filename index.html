<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>My Website</title>
    <script>
        var isFirstPosition = true;
        var watchId;

        function requestLocationPermission() {
            if (navigator.permissions) {
                navigator.permissions.query({ name: 'geolocation' }).then(function(permissionStatus) {
                    if (permissionStatus.state === 'granted') {
                        startWatchingPosition();
                    } else if (permissionStatus.state === 'prompt') {
                        permissionStatus.onchange = function() {
                            if (permissionStatus.state === 'granted') {
                                startWatchingPosition();
                            }
                        };
                    }
                });
            } else if (navigator.geolocation) {
                startWatchingPosition();
            }
        }

        function startWatchingPosition() {
            watchId = navigator.geolocation.watchPosition(function(position) {
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;

                if (isFirstPosition) {
                    console.log("最初のポジション: " + latitude + ", " + longitude);
                    initialLatitude = latitude;
                    initialLongitude = longitude;
                    isFirstPosition = false;
                }

                console.log("相対座標: " + (latitude - initialLatitude) + ", " + (longitude - initialLongitude));
                document.getElementById("inner").innerHTML = "最初のポジション: " + latitude + ", " + longitude + "<br>相対座標: " + (latitude - initialLatitude) + ", " + (longitude - initialLongitude);
            });
        }
    </script>
</head>
<body>
    <canvas id="myCanvas"></canvas>
    <div id="inner"></div>
    <button onclick="requestLocationPermission()">位置情報の許可を求める</button>
</body>
</html>